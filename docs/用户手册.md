# 🛰️ Satellite Channel Simulator — 用户手册

> **版本**: Phase 4 完成版  
> **更新日期**: 2026-02-20  
> **技术栈**: React + Chart.js + satellite.js (SGP4) + HTML5 Canvas

---

## 目录

1. [系统概述](#1-系统概述)
2. [页面布局总览](#2-页面布局总览)
3. [模块一：SGP4 轨道配置](#3-模块一sgp4-轨道配置)
4. [模块二：轨道可视化](#4-模块二轨道可视化)
5. [模块三：历史回放与信道叠加](#5-模块三历史回放与信道叠加)
6. [模块四：链路参数调节](#6-模块四链路参数调节)
7. [模块五：实时链路预算结果](#7-模块五实时链路预算结果)
8. [模块六：频谱与衰减图表](#8-模块六频谱与衰减图表)
9. [模块七：校准与数据导入](#9-模块七校准与数据导入)
10. [物理模型详解](#10-物理模型详解)
11. [常见问题 FAQ](#11-常见问题-faq)

---

## 1. 系统概述

本仿真器面向卫星通信工程师，实现了从 LEO（低轨）到 GEO（静止轨道）的**端到端链路预算仿真**。核心能力包括：

- **基于 SGP4/TLE 的实时轨道推算**：支持任意在轨卫星的精确位置计算
- **多效应叠加的信道建模**：雨衰、气体吸收、云雾损耗、法拉第旋转、闪烁、多径、折射
- **MIMO 容量分析**：基于去极化 XPD 的 Rank-1/Rank-2 容量估算
- **动态过境预报与历史回放**：可预测并回放卫星过境的完整链路变化过程
- **实时气象数据接入**：自动从 Open-Meteo API 获取降雨率进行仿真

---

## 2. 页面布局总览

页面从上到下的排列顺序如下：

| # | 模块 | 说明 |
|---|------|------|
| 1 | 🛰️ SGP4 轨道配置 | 地面站坐标、卫星选择、TLE 管理、过境预报 |
| 2 | 🌍🌟 轨道可视化 | Ground Track 地轨图 + Sky Plot 天球图 |
| 3 | ⏱️ 历史回放 | 时间线生成、动画播放、CSV 导出 |
| 4 | ⚙️ 链路参数 | 频率、雨率、仰角、环境等核心物理参数 |
| 5 | 📊 链路预算结果 | 接收功率、信噪比、各项损耗、MIMO 容量 |
| 6 | 📈 频谱图表 | 损耗 vs 雨率、损耗 vs 频率 |
| 7 | 📁 校准与导入 | 实测数据导入、模型校准、Live Sync |

---

## 3. 模块一：SGP4 轨道配置

### 3.1 启用轨道追踪

勾选 **"Enable Real-time Orbit Tracking"** 后，所有轨道相关功能开启。系统每 2 秒自动计算卫星当前位置，并将仰角和斜距实时注入到链路预算中。

### 3.2 📍 地面站坐标

| 参数 | 单位 | 默认值 | 说明 |
|------|------|--------|------|
| **Lat** | ° | 22.54 | 地面站纬度（北正南负） |
| **Lon** | ° | 114.05 | 地面站经度（东正西负） |
| **Alt** | m | 0 | 地面站海拔高度 |

> ⚠️ 此坐标也被 Live Sync 模块用于获取当地气象数据。修改此处会同步影响气象接口的查询位置。

### 3.3 🚫 快衰落开关

| 状态 | 效果 |
|------|------|
| ☐ 未勾选 | 闪烁（Scintillation）效应以 10Hz 频率实时抖动 |
| ☑ 已勾选 | 闪烁效应被完全禁用，曲线变平滑 |

**建议**：在进行历史回放或仰角-损耗关系分析时，请勾选此项以获得平滑的曲线。

### 3.4 📡 Quick Select（快速选择卫星）

内置 14+ 颗常见卫星的预置库，按国家/地区分组并标注国旗：

| 类别 | 预置卫星 |
|------|---------|
| 🇨🇳 中国 | CSS（天和空间站）、千帆-1/7/19（G60 垣信星座）、北斗-3 M1 |
| 🇺🇸 美国 | ISS、Starlink-1008/1012/30000/31600、Iridium 180、NOAA 20、Hubble、GPS BIIR-2 |
| 🇬🇧 英国 | OneWeb-0012/0601 |

选择后系统自动从 CelesTrak 拉取最新 TLE 并填入。

### 3.5 NORAD ID 与 TLE 管理

| 控件 | 功能 |
|------|------|
| **NORAD ID** 输入框 | 输入任意 NORAD 编号后点击 Fetch |
| **🔄 Fetch Latest TLE** | 从 CelesTrak API 自动获取最新 TLE |
| **TLE Line 1 / 2** | 手动粘贴 TLE 数据（当 API 不可用时） |

**TLE 获取策略（双模降级）**：

```
尝试 CATNR={ID} → 成功？→ 使用
                  → 失败（"No GP data"）→ 尝试 NAME={名称} → 取第一条结果
```

### 3.6 TLE 新鲜度指示器

| 颜色 | 标签 | 含义 |
|------|------|------|
| 🟢 绿色 | FRESH | TLE 历元 < 7 天，精度良好 |
| 🟡 黄色 | AGING | 7~30 天，精度开始下降 |
| 🔴 红色 | STALE | > 30 天，轨道预报严重偏离 |

### 3.7 📅 过境预报 (Pass Prediction)

| 参数 | 说明 |
|------|------|
| **Hours ahead** | 预报时间窗（1~72 小时） |
| **🔍 Predict Passes** | 点击后计算所有过境事件 |

**算法原理**：
1. 以 60 秒为步长遍历未来时间窗
2. 检测仰角从负变正（AOS）和正变负（LOS）的过零点
3. 回溯以 5 秒精度定位精确时刻
4. 记录期间最大仰角时刻（TCA）

**结果表格列说明**：

| 列 | 含义 |
|----|------|
| AOS (Rise) | 信号获取时刻 — 卫星升出地平线 |
| TCA (Peak) | 最近时刻 — 仰角最大值 |
| LOS (Set) | 信号丢失时刻 — 卫星落入地平线下 |
| Max Elev | 本次过境的最大仰角 |
| Duration | 可见持续时长 |
| Quality | 🟢 Excellent (≥45°) / 🟡 Good (≥20°) / 🟠 Low (<20°) |

---

## 4. 模块二：轨道可视化

### 4.1 🌍 Ground Track（地面轨迹图）

**投影方式**：等距圆柱投影（Equirectangular）

| 元素 | 颜色 | 说明 |
|------|------|------|
| 背景 | 深蓝 | 代表海洋 |
| 网格线 | 白色半透明 | 30° 间距经纬线 |
| 绿色轨迹 | 渐变亮度 | 卫星星下点轨迹（未来 ~100 分钟），越靠近当前越亮 |
| 🟢 绿色圆点 | `SAT {高度}km` | 卫星当前星下点位置 |
| 🔴 红色圆点 | `GS` | 地面站位置 |

**自动刷新周期**：每 5 秒

### 4.2 🌟 Sky Plot（天球极坐标图）

**坐标体系**：
- 圆心 = 天顶（仰角 90°）
- 外圈 = 地平线（仰角 0°）
- 角度 = 方位角（N=0°, E=90°, S=180°, W=270°）

| 元素 | 说明 |
|------|------|
| 同心圆 | 0°/30°/60°/90° 仰角等值线 |
| 黄色外圈 | 地平线 |
| 🟢 绿色弧段 | 卫星在地平线以上的可视段 |
| 🔴 红色弧段 | 地平线以下的不可视段 |
| N/S/E/W 标签 | 四方位基准 |

---

## 5. 模块三：历史回放与信道叠加

### 5.1 控制面板

| 控件 | 功能 |
|------|------|
| **Duration (min)** | 回放时间窗长度（5~120 分钟） |
| **📊 Generate Timeline** | 预计算全部帧（每 10 秒一帧） |
| **▶️ Play / ⏸ Pause** | 动画播放/暂停 |
| **Speed** | 播放倍速（1x/2x/5x/10x/20x） |
| **💾 Export CSV** | 导出全部指标为 CSV 文件 |
| **时间滑块** | 手动拖拽到任意帧 |

### 5.2 双 Y 轴联合分析图

| 数据系列 | Y 轴 | 颜色 | 含义 |
|----------|------|------|------|
| Elevation (°) | 左轴 | 🟢 绿色填充 | 卫星仰角随时间变化 |
| Total Path Loss (dB) | 右轴 | 🔴 红色实线 | 总路径损耗随时间变化 |
| FSPL Δ (dB) | 右轴 | 🔵 蓝色虚线 | 相对 GEO 的自由空间损耗偏移 |

### 5.3 CSV 导出格式

```csv
Time,Elevation,Azimuth,SlantRange_km,TotalLoss_dB,DeltaFSPL_dB,AtmLoss_dB,SkyNoise_K
16:30:00,12.34,245.6,1234.5,8.76,−12.34,2.45,28.3
...
```

---

## 6. 模块四：链路参数调节

### 6.1 核心物理参数

| 参数 | 控件 | 单位 | 默认值 | 说明 |
|------|------|------|--------|------|
| **Frequency** | 数值输入 | GHz | 30.0 | 载波频率（Ka-band 典型值） |
| **Rain Rate** | 滑块 | mm/h | 20.0 | 瞬时雨率（0=晴天，100=暴雨） |
| **Elevation** | 滑块 | ° | 40.0 | 卫星仰角（SGP4 模式下自动覆盖） |
| **Slant Range** | 数值输入 | km | 35786 | 卫星斜距（SGP4 模式下自动覆盖） |

### 6.2 系统参数

| 参数 | 单位 | 默认值 | 说明 |
|------|------|--------|------|
| **EIRP** | dBW | 60.0 | 卫星等效全向辐射功率 |
| **G/T (Rx)** | dBi | 42.0 | 地面站接收天线增益 |
| **T_Rx (LNA)** | K | 150.0 | 低噪声放大器等效噪声温度 |
| **Bandwidth** | MHz | 400.0 | 信道带宽（影响 ISI 分析） |
| **TEC** | TECU | 50.0 | 总电子含量（影响法拉第旋转和闪烁） |
| **XPD_ant** | dB | 35.0 | 天线交叉极化鉴别度 |
| **HPBW** | ° | 2.0 | 半功率波束宽度 |
| **Correction Factor** | — | 1.0 | 校准修正因子 |

### 6.3 环境选择

| 值 | 说明 | 特殊效应 |
|----|------|---------|
| `suburban` | 郊区 | 标准 Lutz-LMS 遮蔽衰落 |
| `urban` | 城市 | 高遮蔽概率 |
| `rural` | 乡村 | 低遮蔽概率 |
| `maritime` | 海面 | 启用双射线多径模型 |

### 6.4 相控阵天线模式

| 开关 | 效果 |
|------|------|
| ☐ 未勾选 | 标准抛物面天线 |
| ☑ 已勾选 | 启用相控阵扫描损耗模型，低仰角时额外衰减 |

---

## 7. 模块五：实时链路预算结果

### 7.1 左侧卡片 — RF 链路详情

| 指标 | 单位 | 公式/来源 | 说明 |
|------|------|-----------|------|
| **Rx Power** | dBm | EIRP + G_Rx − FSPL − Losses | 地面站接收功率 |
| **Noise Floor (N₀)** | dBm | k·T_sys·B | 系统噪底（随天空噪声温度动态变化） |
| **T_sky** | K | 黑体辐射模型 | 天空噪声温度 |
| **Apparent Elev** | ° | 几何仰角 + 折射修正 | 大气折射后的视在仰角 |
| **Pointing Error Loss** | dB | 12·(Δθ/HPBW)² | 折射引起的指向偏差损耗 |
| **Scan Roll-off** | dB | cos³(θ_scan) | 相控阵扫描损耗（仅相控阵模式） |
| **Rain Attenuation** | dB | ITU-R P.838 | 雨衰，与频率和雨率相关 |
| **Gas/Cloud Loss** | dB | ITU-R P.676/840 | 氧气 + 水汽 + 云雾衰减 |
| **Ground Shadowing** | dB | Lutz-LMS 模型 | 建筑/植被遮蔽引起的慢衰落 |
| **Maritime Multipath** | dB | 双射线模型 | 海面反射干涉（仅海面环境） |
| **Scintillation** | dB | SoS 确定性模型 | 对流层 + 电离层湍流闪烁 |
| **Faraday Loss** | dB | ω = 134·TEC/(f²·sinθ) | 法拉第旋转引起的极化损耗 |
| **GEO FSPL Δ** | dB | 20·log₁₀(d/35786) | 相对 GEO 参考距离的自由空间损耗偏移 |
| **Path Loss (rel)** | dB | Σ 所有效应 | 相对总路径损耗 |
| **Effective SNR** | dB | Rx_Power − N₀ | 有效信噪比 |

### 7.2 右侧卡片 — MIMO & 容量分析

| 指标 | 说明 |
|------|------|
| **XPD** | 系统交叉极化鉴别度（含雨衰退化） |
| **Rank 2 Capacity** | 双极化 MIMO 频谱效率（bps/Hz） |
| **Rank 1 Capacity** | 单极化频谱效率（bps/Hz） |
| **Recommendation** | 是否建议使用 MIMO |
| **Group Delay** | 电离层群延迟（ns） |
| **Pulse Broadening** | 色散展宽（ns） |
| **ISI 分析** | 如带宽超过最大符号率 → 红色警告 |

---

## 8. 模块六：频谱与衰减图表

### 8.1 Attenuation vs Rain Rate

- **X 轴**：雨率 (mm/h)，从 0 到 100
- **Y 轴**：总损耗 (dB)
- **蓝绿色曲线**：理论模型
- **蓝色散点**：实测数据（加载后可见）

### 8.2 Attenuation vs Frequency

- **X 轴**：频率 (GHz)，从 1 到 70
- **Y 轴**：总损耗 (dB)
- **蓝绿色曲线**：跨频段衰减特性
- 可清晰看到 22.2 GHz 水汽吸收峰和 60 GHz 氧气吸收峰

---

## 9. 模块七：校准与数据导入

### 9.1 数据导入

支持 JSON 格式的实测数据文件：

```json
[
  { "rainRate": 5, "measuredLoss": 3.2, "freq": 30.0 },
  { "rainRate": 15, "measuredLoss": 8.1 }
]
```

### 9.2 模型校准

点击 **"Run Model Calibration"** 后，系统对修正因子进行最小二乘拟合，使理论曲线尽可能贴合实测数据点。

### 9.3 Live Sync（实时同步）

| 模式 | 说明 |
|------|------|
| **Open-Meteo API** | 自动获取地面站坐标处的实时降雨率 |
| **Loaded JSON Replay** | 按时间序列回放已加载的 JSON 数据 |

点击 **"START LIVE SYNC"** 后，系统以 60 秒间隔自动刷新气象数据。

---

## 10. 物理模型详解

### 10.1 大气衰减模型

#### 雨衰（ITU-R P.838）

$$A_{rain} = k \cdot R^{\alpha} \cdot \frac{L_{eff}}{\sin\theta}$$

其中：
- $k$, $\alpha$：频率相关系数（内置 2~50 GHz 查找表，中间值线性插值）
- $R$：地面雨率 (mm/h)
- $L_{eff}$：有效路径长度（简化为 5 km）
- $\theta$：仰角

#### 气体吸收（ITU-R P.676）

- **氧气**：$A_{O_2} = 0.001 \cdot f^{1.5} / \sin\theta$
- **水汽**：$A_{H_2O} = 0.05 \cdot e^{-0.5 \cdot ((f-22.2)/3)^2} / \sin\theta$（22.2 GHz 共振峰）

#### 云雾衰减（ITU-R P.840）

$$A_{cloud} = 0.05 \cdot (f/30) / \sin\theta$$

### 10.2 法拉第旋转

极化旋转角：

$$\omega = \frac{134 \cdot TEC}{f^2 \cdot \sin\theta} \quad (\text{度})$$

极化损耗：

$$L_{Faraday} = -10 \cdot \log_{10}(\cos^2 \omega)$$

### 10.3 大气折射修正

基于 ITU-R 经验公式：

$$\Delta\theta = \frac{1.02}{\tan(\theta + \frac{10.3}{\theta + 5.11})} \div 60 \quad (\text{度})$$

低仰角时修正量可达 0.5° 以上。

### 10.4 指向偏差损耗

$$L_{pointing} = 12 \cdot \left(\frac{\Delta\theta}{HPBW}\right)^2 \quad (\text{dB})$$

当天线未修正大气折射时的波束偏移损耗。

### 10.5 相控阵扫描损耗

$$L_{scan} = -30 \cdot \log_{10}(\cos\theta_{scan})$$

其中 $\theta_{scan}$ 为偏离天顶方向的扫描角。

### 10.6 Lutz-LMS 遮蔽衰落

根据环境类型不同，以概率方式模拟建筑/植被对信号的遮蔽和散射效应：

| 环境 | 遮蔽概率 | 平均衰落深度 |
|------|---------|-------------|
| suburban | 中等 | 3~8 dB |
| urban | 高 | 5~15 dB |
| rural | 低 | 1~3 dB |

### 10.7 海面双射线多径

$$L_{multipath} = -20 \cdot \log_{10}|1 + \Gamma \cdot e^{j \cdot \Delta\phi}|$$

其中 $\Gamma$ 为海面菲涅尔反射系数（近似 −1），$\Delta\phi$ 为直射与反射波的相位差。低仰角时出现深度干涉零点。

### 10.8 闪烁（Scintillation）

#### 对流层闪烁方差

$$\sigma_{tropo} = 0.025 \cdot f^{0.58} / \sin^{1.2}\theta$$

#### 电离层闪烁方差

$$\sigma_{iono} = \frac{TEC}{100} \cdot \frac{2}{f^{1.5}} / \sin^{1.2}\theta$$

#### 合成闪烁

$$\sigma_{total} = \sqrt{\sigma_{tropo}^2 + \sigma_{iono}^2}$$

时域实现采用**确定性正弦叠加法（Sum-of-Sinusoids, SoS）**替代 `Math.random()`，确保可重复性。

### 10.9 电离层群延迟与色散

#### 群延迟

$$\tau_{group} = \frac{134 \cdot TEC}{f^2 \cdot \sin\theta} \quad (\text{ns})$$

#### 脉冲展宽（色散）

$$\Delta\tau = \frac{2 \cdot 134 \cdot TEC \cdot B_{GHz}}{f^3 \cdot \sin\theta} \quad (\text{ns})$$

#### ISI 判定

$$R_{max} = \frac{1}{2 \cdot \Delta\tau}$$

当请求带宽超过 $R_{max}$ 时，系统显示 **⚠️ ISI WARNING**。

### 10.10 天空噪声温度

$$T_{sky} = 2.7 + T_{atm}$$

其中 $T_{atm}$ 为大气辐射温度：

$$T_{atm} = 290 \cdot (1 - 10^{-A_{total}/10})$$

雨天时 $T_{atm}$ 急剧上升（暴雨时可达 ~260K），导致系统噪底显著抬升。

### 10.11 FSPL 偏移量

$$\Delta FSPL = 20 \cdot \log_{10}\left(\frac{d}{35786}\right) \quad (\text{dB})$$

以 GEO 距离（35786 km）为参考的自由空间路径损耗偏移。LEO 卫星典型值为 −20 ~ −30 dB（增益）。

---

## 11. 常见问题 FAQ

### Q: Starlink 卫星为什么不能通过 NORAD ID 直接查询？

Starlink 卫星数量超过 6000 颗，CelesTrak 未将每颗卫星单独编入 `CATNR` 直查索引。系统会自动降级为按 `NAME` 搜索。

### Q: 中国星网 (GW/国网) 卫星为什么查不到？

截至目前，中国星网的 TLE 数据尚未在 CelesTrak 公开数据库中发布。你可以手动获取 TLE 后粘贴到 TLE Line 1/2 输入框中进行追踪。

### Q: 为什么回放时曲线抖动很剧烈？

这是闪烁效应（Scintillation）的正常表现。如需平滑曲线进行分析，请勾选 **🚫 Disable Fast Fading** 开关。

### Q: 如何生成最完整的链路预算分析？

1. Fetch 最新 TLE
2. 设置正确的地面站坐标和海拔
3. 点击 "Predict Passes" 找到高仰角过境
4. 在 Replay 面板设置对应时间窗
5. 点击 "Generate Timeline" → 展开双轴图
6. 点击 "Export CSV" 导出所有指标

### Q: 如何模拟实际的通信质量？

关注 **Effective SNR**：
- **> 15 dB**：可靠通信，高阶调制可用
- **5~15 dB**：中等质量，建议使用低阶调制
- **< 5 dB**：链路临界，可能频繁中断
- **< 0 dB**：链路不可用

---

> 📝 本手册随功能迭代持续更新。如有技术问题请参考源代码 `model.js` 中的注释。
